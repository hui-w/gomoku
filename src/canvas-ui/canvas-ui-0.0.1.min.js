/* Canvas-UI 0.0.1 | https://github.com/hui-w/canvas-ui */if(!Element.prototype.createChild){Element.prototype.createChild=function(a,c,d){var b=document.createElement(a);this.appendChild(b);if(c){for(key in c){b.setAttribute(key,c[key])}}if(d){b.innerHTML=d}return b}}var canvasPrototype=window.CanvasRenderingContext2D&&CanvasRenderingContext2D.prototype;if(!canvasPrototype.antiFuzzyLine){canvasPrototype.antiFuzzyLine=function(b,d,a,c){if(this.lineWidth%2==1){b-=0.5;d-=0.5;a-=0.5;c-=0.5}this.moveTo(b,d);this.lineTo(a,c)}}if(!canvasPrototype.drawStone){canvasPrototype.drawStone=function(c,b,g,d){var a=b+d;var f=g+d;this.save();this.beginPath();this.arc(a,f,d-2,0,2*Math.PI);this.closePath();var e=this.createRadialGradient(a+2,f-2,d-2,a+2,f-2,0);if(c){e.addColorStop(0,"#0A0A0A");e.addColorStop(1,"#636766")}else{e.addColorStop(0,"#999999");e.addColorStop(1,"#FFFFFF")}this.fillStyle=e;this.fill();this.restore()}}if(!canvasPrototype.roundRect){canvasPrototype.roundRect=function(a,e,b,c,d){if(b<2*d){d=b/2}if(c<2*d){d=c/2}this.beginPath();this.moveTo(a+d,e);this.arcTo(a+b,e,a+b,e+c,d);this.arcTo(a+b,e+c,a,e+c,d);this.arcTo(a,e+c,a,e,d);this.arcTo(a,e,a+b,e,d);this.closePath();return this}}if(!canvasPrototype.fillTextEx){canvasPrototype.fillTextEx=function(e,b,g,c,f){this.save();var a=b;if(c!="left"){var d=this.measureText(e).width;if(c=="center"){a-=d/2}else{if(c=="right"){a-=d}}}this.textBaseline=f;this.fillText(e,a,g);this.restore()}}if(!Array.prototype.forEach){Array.prototype.forEach=function(f){var c,b;if(this==null){throw new TypeError("this is null or not defined")}var e=Object(this);var a=e.length>>>0;if(typeof f!=="function"){throw new TypeError(f+" is not a function")}if(arguments.length>1){c=arguments[1]}b=0;while(b<a){var d;if(b in e){d=e[b];f.call(c,d,b,e)}b++}}}(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(g){var f=this.prototype;a=true;var e=new this();a=false;for(var d in g){e[d]=typeof g[d]=="function"&&typeof f[d]=="function"&&b.test(g[d])?(function(h,i){return function(){var k=this._super;this._super=f[h];var j=i.apply(this,arguments);this._super=k;return j}})(d,g[d]):g[d]}function c(){if(!a&&this.init){this.init.apply(this,arguments)}}c.prototype=e;c.prototype.constructor=c;c.extend=arguments.callee;return c}})();var component_prototype={id:null,left:0,top:0,width:0,height:0,isEnabled:true,isVisible:true,fillStyle:null,strokeStyle:null,lineWidth:0,onRenderExtra:[],onSizeChanged:[],onPositionChanged:[],parent:null,children:[],onrequestPaint:null,onCapture:null,onDrag:null,onRelease:null,init:function(d,c,b,a,e){if(d!=undefined){this.left=d}if(c!=undefined){this.top=c}if(b!=undefined){this.width=b}if(a!=undefined){this.height=a}if(e!=undefined){this.id=e}this.isEnabled=true;this.isVisible=true;this.fillStyle=null;this.strokeStyle=null;this.lineWidth=0;this.onRenderExtra=[];this.onSizeChanged=[];this.onPositionChanged=[];this.parent=null;this.children=[];this.onrequestPaint=null},setEnabled:function(a){if(this.isEnabled===a){return}this.isEnabled=a;this.requestPaint();this.children.forEach(function(b){b.setEnabled(a)})},setVisible:function(a){if(this.isVisible===a){return}this.isVisible=a;this.requestPaint();this.children.forEach(function(b){b.setVisible(a)})},setPosition:function(b,a){if(this.left===b&&this.top===a){return}this.left=b;this.top=a;this.requestPaint();this.triggerCallbacks(this.onPositionChanged,[b,a]);this.children.forEach(function(c){c.requestPaint()})},setPaintHandler:function(a){this.onrequestPaint=a;this.children.forEach(function(b){b.setPaintHandler(a)})},setSize:function(b,a){if(this.width===b&&this.height===a){return}this.width=b;this.height=a;this.triggerCallbacks(this.onSizeChanged,[b,a]);this.requestPaint()},setStrokeStyle:function(a){if(this.strokeStyle===a){return}this.strokeStyle=a;this.requestPaint()},setLineWidth:function(a){if(this.lineWidth===a){return}this.lineWidth=a;this.requestPaint()},setFillStyle:function(a){if(this.fillStyle===a){return}this.fillStyle=a;this.requestPaint()},addChild:function(a){this.children.push(a);a.bindParent(this)},bindParent:function(a){this.parent=a},requestPaint:function(){if(typeof this.onrequestPaint=="function"){this.onrequestPaint()}},getAbsPostion:function(){var c=this.left;var b=this.top;var a=this.parent;while(a!=null){c+=a.left;b+=a.top;a=a.parent}return{left:c,top:b}},isPointInside:function(c,b){var a=this.getAbsPostion();return c>=a.left&&c<=a.left+this.width&&b>=a.top&&b<=a.top+this.height},handleEvent:function(a,c,b){if(!this.isEnabled||!this.isVisible){return}switch(a){case"capture":if(typeof this.onCapture==="function"){this.onCapture(c,b)}break;case"drag":if(typeof this.onDrag==="function"){this.onDrag(c,b)}break;case"release":if(typeof this.onRelease==="function"){this.onRelease(c,b)}break}this.children.forEach(function(d){d.handleEvent(a,c,b)})},render:function(b){if(!this.isVisible){return}b.save();var a=this.getAbsPostion();b.translate(a.left,a.top);if(this.fillStyle){b.fillStyle=this.fillStyle;b.fillRect(0,0,this.width,this.height)}if(this.strokeStyle&&this.lineWidth>0){b.lineWidth=this.lineWidth;b.strokeStyle=this.strokeStyle;b.strokeRect(0,0,this.width,this.height)}this.triggerCallbacks(this.onRenderExtra,[b]);b.restore();this.children.forEach(function(c){c.render(b)})},triggerCallbacks:function(c,a){if(typeof c=="function"){c.apply(this,a)}else{if(typeof c=="object"){for(var b=0;b<c.length;b++){var d=c[b];if(typeof d=="function"){d.apply(this,a)}}}}}};var Component=Class.extend(component_prototype);var button_prototype={isOn:null,radius:null,text:null,font:null,capturedPosition:null,onClick:null,init:function(d,c,b,a,e){this._super(d,c,b,a,e);this.isOn=false;this.radius=0;this.text=null;this.font={size:12,face:"Arial, Helvetica, sans-serif",color:"#000000"};this.capturedPosition=null;this.onClick=[];this.onRenderExtra.push(function(f){if(this.capturedPosition||this.isOn){f.fillStyle="#B5B5B5";f.strokeStyle="#979797"}else{f.fillStyle="#EBEBEB";f.strokeStyle="#979797"}if(this.radius==0){f.beginPath();f.moveTo(0,0);f.lineTo(this.width,0);f.lineTo(this.width,this.height);f.lineTo(0,this.height);f.closePath()}else{f.roundRect(0,0,this.width,this.height,this.radius)}f.fill();f.stroke()});this.onRenderExtra.push(function(f){if(this.text){f.fillStyle=this.font.color;f.font=this.font.size+"px "+this.font.face;f.fillTextEx(this.text,this.width/2,this.height/2,"center","middle")}})},setOn:function(a){if(this.isOn===a){return}this.isOn=a;this.requestPaint()},setRadius:function(a){if(this.radius===a){return}this.radius=a;this.requestPaint()},setText:function(a){if(this.text===a){return}this.text=a;this.requestPaint()},onCapture:function(b,a){if(!this.isPointInside(b,a)){return}this.capturedPosition={left:b,top:a};this.requestPaint()},onRelease:function(d,c){if(!this.capturedPosition){return}if(this.isPointInside(d,c)){if(typeof this.onClick=="function"){this.onClick()}else{if(typeof this.onClick=="object"){for(var a=0;a<this.onClick.length;a++){var b=this.onClick[a];if(typeof b=="function"){b()}}}}}this.capturedPosition=null;this.requestPaint()},onDrag:function(b,a){}};var Button=Component.extend(button_prototype);var label_prototype={font:null,init:function(b,a,c,d){this._super(this,b,a,0,0,d);this.font={size:12,face:"Arial, Helvetica, sans-serif",color:"#000000"};this.text=c;this.horizontalAlign="left";this.verticalAlign="top";this.onRenderExtra.push(function(e){e.fillStyle=this.font.color;e.font=this.font.size+"px "+this.font.face;e.fillTextEx(this.text,0,0,this.horizontalAlign,this.verticalAlign)})},setHorizontalAlign:function(a){if(a===this.horizontalAlign){return}this.horizontalAlign=a;this.requestPaint()},setVerticalAlign:function(a){if(a===this.verticalAlign){return}this.verticalAlign=a;this.requestPaint()},setText:function(a){if(a===this.text){return}this.text=a;this.requestPaint()}};var Label=Component.extend(label_prototype);var panel_prototype={init:function(d,c,b,a,e){this._super(d,c,b,a,e)}};var Panel=Component.extend(panel_prototype);var canvas_app_prototype={components:null,delayTimer:null,width:null,height:null,canvas:null,context:null,onResized:null,onWillPaint:null,onDidPaint:null,init:function(){this.components=[];this.delayTimer=null;this.width=0;this.height=0;this.canvas=null;this.context=null;this.onResized=this.canvasResized;this.onWillPaint=this.canvasWillPaint;this.onDidPaint=this.canvasDidPaint},registerComponent:function(a){a.setPaintHandler(function(){this.requestPaint()}.bind(this));this.components.push(a)},registerComponents:function(a){a.forEach(function(b){this.registerComponent(b)}.bind(this))},requestPaint:function(){if(this.delayTimer){return}this.delayTimer=setTimeout(function(){this.redraw();this.delayTimer=null}.bind(this),50)},redrawComponents:function(b){for(var a=0;a<this.components.length;a++){if(typeof this.components[a].render==="function"){this.components[a].render(b)}}},dispatchEvent:function(c,e,d){for(var b=0;b<this.components.length;b++){var a=this.components[b];a.handleEvent(c,e,d)}},render:function(){this.width=document.documentElement.clientWidth;this.height=document.documentElement.clientHeight;var a=document.body;var c=a.createChild("div",{id:"app-wrapper"});this.canvas=c.createChild("canvas",{id:"app-canvas",width:0,height:0});if(typeof G_vmlCanvasManager!="undefined"){this.canvas=G_vmlCanvasManager.initElement(this.canvas)}this.context=this.canvas.getContext("2d");this.canvas.addEventListener("mousedown",this.handleMouse.bind(this),false);this.canvas.addEventListener("mousemove",this.handleMouse.bind(this),false);this.canvas.addEventListener("mouseup",this.handleMouse.bind(this),false);this.canvas.addEventListener("touchstart",this.handleTouch.bind(this),false);this.canvas.addEventListener("touchend",this.handleTouch.bind(this),false);this.canvas.addEventListener("touchmove",this.handleTouch.bind(this),false);this.resize();var b=function(){var e=document.documentElement.clientWidth;var d=document.documentElement.clientHeight;if(e!=this.width||d!=this.height){this.width=e;this.height=d;this.resize()}}.bind(this);setInterval(b,200)},resize:function(){this.canvas.width=this.width;this.canvas.height=this.height;if(typeof this.onResized==="function"){this.onResized(this.width,this.height)}this.requestPaint()},getEventPosition:function(a){return{left:a.pageX-this.canvas.offsetLeft,top:a.pageY-this.canvas.offsetTop}},handleMouse:function(a){switch(a.type){case"mousedown":this.capture(a);break;case"mousemove":this.drag(a);break;case"mouseup":this.release(a);break}},handleTouch:function(a){a.preventDefault();switch(a.type){case"touchstart":if(a.touches.length==1){this.capture(a.targetTouches[0])}else{if(a.touches.length==2){}}break;case"touchend":if(a.changedTouches.length==1){this.release(a.changedTouches[0])}break;case"touchmove":if(a.changedTouches.length==1){this.drag(a.changedTouches[0])}else{if(a.touches.length==2){}}break}},capture:function(a){var b=this.getEventPosition(a);this.dispatchEvent("capture",b.left,b.top)},drag:function(a){var b=this.getEventPosition(a);this.dispatchEvent("drag",b.left,b.top)},release:function(a){var b=this.getEventPosition(a);this.dispatchEvent("release",b.left,b.top)},redraw:function(){this.canvas.width=this.canvas.width;this.canvas.height=this.canvas.height;if(typeof this.onWillPaint==="function"){this.onWillPaint(this.context)}this.redrawComponents(this.context);if(typeof this.onDidPaint==="function"){this.onDidPaint(this.context)}}};var CanvasApp=Class.extend(canvas_app_prototype);
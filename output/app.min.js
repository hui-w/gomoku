var app_prototype={menu:null,chessboard:null,playerIndicator:null,btnMenu:null,btnBack:null,lblCurrent:null,lblMenu:null,lblBack:null,init:function(){this._super();this.initChildren();this.registerComponents([this.chessboard,this.playerIndicator,this.btnMenu,this.btnBack,this.lblCurrent,this.lblMenu,this.lblBack,this.menu]);this.render();this.showMenu(true)},canvasResized:function(c,j){var h=(c>j?j:c)-Config.Canvas.padding*2;var b=Math.abs(c-j);var a=Config.Button.size+Config.Button.margin*2;if(b<a){h-=a-b}this.chessboard.setBoardSize(h);this.menu.setSize(c,j);var d=3;var i=2;var f=Config.Button.size*d+Config.Button.margin*(d-1);if(c>j){var e=Config.Canvas.padding+h+Config.Button.margin;var g=Math.floor((j-f)/2);this.lblCurrent.setPosition(e+Config.Button.size/2,g-i);this.playerIndicator.setPosition(e,g);g+=Config.Button.size+Config.Button.margin;this.lblMenu.setPosition(e+Config.Button.size/2,g-i);this.btnMenu.setPosition(e,g);g+=Config.Button.size+Config.Button.margin;this.lblBack.setPosition(e+Config.Button.size/2,g-i);this.btnBack.setPosition(e,g)}else{var e=Math.floor((c-f)/2);var g=Config.Canvas.padding+h+Config.Button.margin;this.lblCurrent.setPosition(e+Config.Button.size/2,g-i);this.playerIndicator.setPosition(e,g);e+=Config.Button.size+Config.Button.margin;this.lblMenu.setPosition(e+Config.Button.size/2,g-i);this.btnMenu.setPosition(e,g);e+=Config.Button.size+Config.Button.margin;this.lblBack.setPosition(e+Config.Button.size/2,g-i);this.btnBack.setPosition(e,g)}},canvasWillPaint:function(a){this.playerIndicator.onRenderExtra=function(b){var c=Math.floor(this.playerIndicator.width/2);b.drawStone(this.chessboard.isBlackPlaying(),0,0,c)}.bind(this);a.save();a.fillStyle=Config.Canvas.fill;a.fillRect(0,0,this.width,this.height);a.restore()},canvasDidPaint:function(a){console.log("- canvas painted")},initChildren:function(){this.menu=new Menu(0,0);this.menu.onClose=function(b,c){this.showMenu(false);if(b!=null&&c!=null){this.chessboard.reset(b,c)}}.bind(this);this.chessboard=new Chessboard(Config.Canvas.padding,Config.Canvas.padding);var a=Config.Button.size;this.playerIndicator=new Panel(0,0,a,a);this.btnMenu=new Button(0,0,a,a);this.btnMenu.onRenderExtra.push(function(b){b.beginPath();b.antiFuzzyLine(a/4,parseInt(a*0.3),a-a/4,parseInt(a*0.3));b.antiFuzzyLine(a/4,parseInt(a*0.5),a-a/4,parseInt(a*0.5));b.antiFuzzyLine(a/4,parseInt(a*0.7),a-a/4,parseInt(a*0.7));b.strokeStyle="#000";b.stroke()});this.btnMenu.onClick=function(){this.showMenu(true)}.bind(this);this.btnBack=new Button(0,0,a,a);this.btnBack.onRenderExtra.push(function(b){b.beginPath();b.moveTo(a/4,a/2);b.lineTo(a-a/4,a/2);b.moveTo(a/2,a/4);b.lineTo(a/4,a/2);b.lineTo(a/2,a-a/4);b.strokeStyle="#000";b.stroke()});this.btnBack.onClick=function(){this.chessboard.back()}.bind(this);this.lblCurrent=new Label(0,0,"Player");this.lblCurrent.setHorizontalAlign("center");this.lblCurrent.setVerticalAlign("bottom");this.lblMenu=new Label(0,0,"Menu");this.lblMenu.setHorizontalAlign("center");this.lblMenu.setVerticalAlign("bottom");this.lblBack=new Label(0,0,"Back");this.lblBack.setHorizontalAlign("center");this.lblBack.setVerticalAlign("bottom")},showMenu:function(a){this.menu.setVisible(a);this.menu.showCloseButton(this.chessboard.chessData!=null);this.chessboard.setEnabled(!a);this.btnBack.setEnabled(!a)}};var App=CanvasApp.extend(app_prototype);var app=null;addEventListener("load",function(){app=new App()});var chessboard_prototype={unitSize:null,halfSize:null,stones:null,chessData:null,robotConfig:null,robot:null,rule:null,capturedPos:null,dragOffset:null,selectedCell:null,init:function(b,a){this._super(b,a);this.unitSize=0;this.halfSize=0;this.stones=[];this.chessData=null;this.robotConfig={black:false,white:false};this.robot=new Robot(this);this.rule=new Rule(this);this.capturedPos=null;this.dragOffset=null;this.selectedCell=null;this.onRenderExtra.push(this.renderChessboard);this.onRenderExtra.push(this.renderStones);this.onRenderExtra.push(this.renderHighlight);this.onRenderExtra.push(this.renderResults)},reset:function(a,b){this.stones=[];this.selectedCell=null;this.syncToChessData();this.robotConfig={black:a,white:b};this.rule.reset();this.robotPlay();this.requestPaint()},renderChessboard:function(b){var c={left:this.halfSize,top:this.halfSize,right:this.width-this.halfSize,bottom:this.height-this.halfSize};b.beginPath();for(var a=0;a<Config.Board.size;a++){b.antiFuzzyLine(c.left,c.top+this.unitSize*a,c.right,c.top+this.unitSize*a);b.antiFuzzyLine(c.left+this.unitSize*a,c.top,c.left+this.unitSize*a,c.bottom)}b.lineWidth=1;b.strokeStyle=Config.Board.stroke;b.stroke()},renderStones:function(c){for(var b=0;b<this.stones.length;b++){var f=this.stones[b].row;var a=this.stones[b].col;var e=a*this.unitSize;var d=f*this.unitSize;c.drawStone(b%2==0,e,d,this.halfSize)}},renderHighlight:function(c){if(this.selectedCell){var f=this.selectedCell.col*this.unitSize;var e=this.selectedCell.row*this.unitSize;var b=f+this.unitSize;var a=e+this.unitSize;var d=Math.floor(this.unitSize/4);c.save();c.beginPath();c.moveTo(f,e+d);c.lineTo(f,e);c.lineTo(f+d,e);c.moveTo(b-d,e);c.lineTo(b,e);c.lineTo(b,e+d);c.moveTo(b,a-d);c.lineTo(b,a);c.lineTo(b-d,a);c.moveTo(f+d,a);c.lineTo(f,a);c.lineTo(f,a-d);c.lineWidth=2;c.strokeStyle=Config.Selected.stroke;c.stroke();c.restore()}},renderResults:function(c){if(this.rule.isGameOver()){c.beginPath();for(var b=0;b<this.rule.results.length;b++){var a=this.rule.results[b];var g=a[0]*this.unitSize+this.halfSize;var f=a[1]*this.unitSize+this.halfSize;var e=a[2]*this.unitSize+this.halfSize;var d=a[3]*this.unitSize+this.halfSize;c.moveTo(f,g);c.lineTo(d,e)}c.lineWidth=this.halfSize/2;c.strokeStyle=Config.Board.resultStyle;c.stroke()}},onCapture:function(b,a){this.capturedPos={left:b,top:a};this.setSelectedCell(b,a)},onDrag:function(b,a){if(!this.capturedPos){return}if(!this.dragOffset){var c=Math.pow(b-this.capturedPos.left,2)+Math.pow(a-this.capturedPos.top,2);if(c>=Math.pow(Config.Selected.dragSensitive*this.unitSize,2)){this.dragOffset={left:b-this.capturedPos.left,top:a-this.capturedPos.top}}}else{this.setSelectedCell(b-this.dragOffset.left,a-this.dragOffset.top)}},onRelease:function(b,a){this.capturedPos=null;this.dragOffset=null;if(this.selectedCell&&!this.hasStone(this.selectedCell.row,this.selectedCell.col)){this.putStone(this.selectedCell.row,this.selectedCell.col)}},setBoardSize:function(a){this.unitSize=Math.floor(a/Config.Board.size);this.halfSize=Math.floor(a/Config.Board.size/2);this.width=this.unitSize*Config.Board.size-1;this.height=this.unitSize*Config.Board.size-1},syncToChessData:function(f,d){if(arguments.length===2){var g=f.row;var c=f.col;this.chessData[g][c]=d}this.chessData=[];for(var e=0;e<Config.Board.size;e++){this.chessData[e]=[];for(var b=0;b<Config.Board.size;b++){this.chessData[e][b]=0}}for(var e=0;e<this.stones.length;e++){var g=this.stones[e].row;var c=this.stones[e].col;var a=e%2===0;this.chessData[g][c]=a?1:2}},back:function(){if(this.stones.length<=0){return}if(this.robotConfig.black&&this.robotConfig.white){return}else{if(!this.robotConfig.black&&!this.robotConfig.white){var b=this.stones.pop();this.syncToChessData(b,0)}else{if(this.stones.length>=2){var b=this.stones.pop();this.syncToChessData(b,0);b=this.stones.pop();this.syncToChessData(b,0)}}}if(this.stones.length>0){var a=this.stones[this.stones.length-1];this.selectedCell={row:a.row,col:a.col}}this.rule.reset();this.requestPaint()},isBlackPlaying:function(){return this.stones.length%2===0},putStone:function(c,a){if(this.rule.isGameOver()){return}var b={row:c,col:a};this.selectedCell=b;this.stones.push(b);var d=this.isBlackPlaying()?2:1;this.syncToChessData(b,d);this.rule.syncStatus(c,a);this.requestPaint();if(!this.rule.isGameOver()){setTimeout(function(){this.robotPlay()}.bind(this),100)}},robotPlay:function(){if((!this.robotConfig.black&&this.isBlackPlaying())||(!this.robotConfig.white&&!this.isBlackPlaying())){return}if(this.stones.length<=0){var d=Math.floor(Config.Board.size/2);this.putStone(d,d)}else{var a=this.robot.getPosition();if(a.length===2&&a[0]!==undefined&&a[1]!==undefined){var c=a[0];var b=a[1];this.putStone(c,b)}}},setRobot:function(a,b){this.robotConfig[a]=b;if(this.robotConfig.black||this.robotConfig.white){this.robotPlay()}},setSelectedCell:function(f,e){var a=this.selectedCell?this.selectedCell.row:null;var c=this.selectedCell?this.selectedCell.col:null;if(f<this.left||f>this.left+this.width||e<this.top||e>this.top+this.height){this.selectedCell=null}else{this.selectedCell=this.posToCell(f,e)}var b=this.selectedCell?this.selectedCell.row:null;var d=this.selectedCell?this.selectedCell.col:null;if(b!=a||d!=c){this.requestPaint()}},posToCell:function(b,a){return{col:Math.floor((b-this.left)/this.unitSize),row:Math.floor((a-this.top)/this.unitSize)}},hasStone:function(c,a){for(var b=0;b<this.stones.length;b++){if(c===this.stones[b].row&&a===this.stones[b].col){return true}}return false}};var Chessboard=Component.extend(chessboard_prototype);function $(){var c=new Array();for(var b=0;b<arguments.length;b++){var a=arguments[b];if(typeof a=="string"){a=document.getElementById(a)}if(arguments.length==1){return a}c.push(a)}return c}Element.prototype.hasClassName=function(b){return new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)").test(this.className)};Element.prototype.addClassName=function(b){if(!this.hasClassName(b)){this.className=[this.className,b].join(" ")}};Element.prototype.removeClassName=function(c){if(this.hasClassName(c)){var d=this.className;this.className=d.replace(new RegExp("(?:^|\\s+)"+c+"(?:\\s+|$)","g")," ")}};var Config={Canvas:{padding:10,fill:"RGBA(222, 237, 247, 0.3)"},Menu:{buttonWidth:160,buttonHeight:32},Board:{size:15,stroke:"RGBA(200, 200, 200, 0.8)",resultStyle:"RGBA(0, 255, 0, 0.5)"},Selected:{stroke:"RGBA(255, 0, 0, 0.5)",dragSensitive:3},Button:{size:38,margin:28}};var menu_prototype={onClose:null,padding:null,showClose:null,btn1:null,btn2:null,btn3:null,btn4:null,init:function(b,a){this._super(b,a);this.onClose=null;this.padding={h:35,v:25};this.onRenderExtra.push(this.renderMask);this.onRenderExtra.push(this.renderBorder);this.btn1=new Button(0,0,Config.Menu.buttonWidth,Config.Menu.buttonHeight,"button1");this.btn1.setText("Human vs. Human");this.btn1.setRadius(8);this.btn1.onClick=function(){this.triggerOnClose(false,false)}.bind(this);this.addChild(this.btn1);this.btn2=new Button(0,0,Config.Menu.buttonWidth,Config.Menu.buttonHeight,"button2");this.btn2.setText("Human vs. Robot");this.btn2.setRadius(8);this.btn2.onClick=function(){this.triggerOnClose(false,true)}.bind(this);this.btn2.onRenderExtra.push(function(c){c.drawStone(false,160-20-6,6,10)});this.addChild(this.btn2);this.btn3=new Button(0,0,Config.Menu.buttonWidth,Config.Menu.buttonHeight,"button3");this.btn3.setText("Robot vs. Human");this.btn3.setRadius(8);this.btn3.onClick=function(){this.triggerOnClose(true,false)}.bind(this);this.btn3.onRenderExtra.push(function(c){c.drawStone(true,6,6,10)});this.addChild(this.btn3);this.btn4=new Button(0,0,Config.Menu.buttonWidth,Config.Menu.buttonHeight,"button4");this.btn4.setText("Robot vs. Robot");this.btn4.setRadius(8);this.btn4.onClick=function(){this.triggerOnClose(true,true)}.bind(this);this.btn4.onRenderExtra.push(function(c){c.drawStone(true,6,6,10)});this.btn4.onRenderExtra.push(function(c){c.drawStone(false,160-20-6,6,10)});this.addChild(this.btn4);this.btnClose=new Button(0,0,20,20);this.btnClose.setRadius(2);this.btnClose.onClick=function(){this.triggerOnClose()}.bind(this);this.btnClose.onRenderExtra.push(function(c){c.beginPath();c.moveTo(4,4);c.lineTo(16,16);c.moveTo(16,4);c.lineTo(4,16);c.strokeStyle="RGB(255, 0, 0)";c.stroke()});this.addChild(this.btnClose);this.onSizeChanged=this.sizeChangedHandler},sizeChangedHandler:function(d,a){var c=d/2-Config.Menu.buttonWidth/2;var b=a/2-2.6*Config.Menu.buttonHeight;this.btnClose.setPosition(c+Config.Menu.buttonWidth+this.padding.h-24,b-this.padding.v+4);this.btn1.setPosition(c,b);b+=Config.Menu.buttonHeight*1.4;this.btn2.setPosition(c,b);b+=Config.Menu.buttonHeight*1.4;this.btn3.setPosition(c,b);b+=Config.Menu.buttonHeight*1.4;this.btn4.setPosition(c,b);b+=Config.Menu.buttonHeight*1.4},showCloseButton:function(a){this.btnClose.setVisible(a)},renderMask:function(a){a.fillStyle="RGBA(0, 0, 0, 0.5)";a.fillRect(0,0,this.width-0,this.height-0)},renderBorder:function(b){var a=Config.Menu.buttonHeight*(4+0.4*3)+this.padding.v*2;var e=this.width/2-Config.Menu.buttonWidth/2-this.padding.h;var d=this.height/2-a/2;var c=Config.Menu.buttonWidth+this.padding.h*2;b.beginPath();b.rect(e,d,c,a);b.strokeStyle="RGBA(0, 0, 0, 1)";b.fillStyle="RGBA(255, 255, 255, 0.8)";b.stroke();b.fill()},triggerOnClose:function(a,b){if(typeof this.onClose=="function"){this.onClose(a,b)}}};var Menu=Component.extend(menu_prototype);function Robot(a){this.chessBoard=a}Robot.prototype={getPosition:function(){var c=new Array(2);var d=0;for(var b=0;b<15;b++){for(var e=0;e<15;e++){if(this.chessBoard.chessData[b][e]==0){if(this.judge(b,e)>d){d=this.judge(b,e);c[0]=b;c[1]=e}}}}return c},judge:function(e,g){var f=parseInt(this.leftRight(e,g,1))+parseInt(this.topBottom(e,g,1))+parseInt(this.rightBottom(e,g,1))+parseInt(this.rightTop(e,g,1))+100;var d=parseInt(this.leftRight(e,g,2))+parseInt(this.topBottom(e,g,2))+parseInt(this.rightBottom(e,g,2))+parseInt(this.rightTop(e,g,2));var c=f+d;return c},leftRight:function(k,h,e){var a=0;var b=0;var g=0;var f=new Array(15);for(var d=0;d<15;d++){f[d]=new Array(15);for(var c=0;c<15;c++){f[d][c]=this.chessBoard.chessData[d][c]}}f[k][h]=e;for(var d=k;d>=0;d--){if(f[d][h]==e){g++}else{if(f[d][h]==0){b+=1;d=-1}else{a+=1;d=-1}}}for(var d=k;d<=14;d++){if(f[d][h]==e){g++}else{if(f[d][h]==0){b+=1;d=100}else{a+=1;d=100}}}g-=1;return this.model(g,a)},topBottom:function(k,h,e){var a=0;var b=0;var g=0;var f=new Array(15);for(var d=0;d<15;d++){f[d]=new Array(15);for(var c=0;c<15;c++){f[d][c]=this.chessBoard.chessData[d][c]}}f[k][h]=e;for(var d=h;d>=0;d--){if(f[k][d]==e){g++}else{if(f[k][d]==0){b+=1;d=-1}else{a+=1;d=-1}}}for(var d=h;d<=14;d++){if(f[k][d]==e){g++}else{if(f[k][d]==0){b+=1;d=100}else{a+=1;d=100}}}g-=1;return this.model(g,a)},rightBottom:function(k,h,e){var a=0;var b=0;var g=0;var f=new Array(15);for(var d=0;d<15;d++){f[d]=new Array(15);for(var c=0;c<15;c++){f[d][c]=this.chessBoard.chessData[d][c]}}f[k][h]=e;for(var d=k,c=h;d>=0&&c>=0;){if(f[d][c]==e){g++}else{if(f[d][c]==0){b+=1;d=-1}else{a+=1;d=-1}}d--;c--}for(var d=k,c=h;d<=14&&c<=14;){if(f[d][c]==e){g++}else{if(f[d][c]==0){b+=1;d=100}else{a+=1;d=100}}d++;c++}g-=1;return this.model(g,a)},rightTop:function(k,h,e){var a=0;var b=0;var g=0;var f=new Array(15);for(var d=0;d<15;d++){f[d]=new Array(15);for(var c=0;c<15;c++){f[d][c]=this.chessBoard.chessData[d][c]}}f[k][h]=e;for(var d=k,c=h;d>=0&&c<=14;){if(f[d][c]==e){g++}else{if(f[d][c]==0){b+=1;d=-1}else{a+=1;d=-1}}d--;c++}for(var d=k,c=h;d<=14&&c>=0;){if(f[d][c]==e){g++}else{if(f[d][c]==0){b+=1;d=100}else{a+=1;d=100}}d++;c--}g-=1;return this.model(g,a)},model:function(g,b){var f=0;var e=1;var a=1500;var d=4000;var h=10000;var c=100000;if(g==1&&b==1){return e}else{if(g==2){if(b==0){return a}else{if(b==1){return e}else{return f}}}else{if(g==3){if(b==0){return d}else{if(b==1){return a}else{return f}}}else{if(g==4){if(b==0){return h}else{if(b==1){return d}else{return f}}}else{if(g==5){return c}}}}}return f}};function RobotV2(a){this.chessBoard=a}RobotV2.prototype={};function Rule(a){this.chessBoard=a;this.results=[]}Rule.prototype={getSideLength:function(h,b,a,g){var e=h;var i=b;var f=this.chessBoard.chessData;var d=0;while(e+a>=0&&i+g>=0&&e+a<Config.Board.size&&i+g<Config.Board.size&&f[e+a][i+g]===f[e][i]){d++;e+=a;i+=g}return d},getLine:function(f,b,a,d){var e=this.getSideLength(f,b,-a,-d);var c=this.getSideLength(f,b,a,d);if(e+c>=4){return[f-a*e,b-d*e,f+a*c,b+d*c]}else{return null}},syncStatus:function(c,b){this.results=[];var a=this.getLine(c,b,0,1);if(a){this.results.push(a)}var a=this.getLine(c,b,1,0);if(a){this.results.push(a)}var a=this.getLine(c,b,1,1);if(a){this.results.push(a)}var a=this.getLine(c,b,1,-1);if(a){this.results.push(a)}},reset:function(){this.results=[]},isGameOver:function(){return this.results.length!==0}};